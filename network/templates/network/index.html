{% extends "network/layout.html" %}
{% load static %}

{% block body %}
  {% if post_form is not None and user.is_authenticated %}
  <h4>New Post</h4>
    <form id="new-post" action="{% url 'newpost' %}" method="post">
      {% csrf_token %}
      {{ post_form }}
      <input type="submit" value="Submit">
    </form>
  {% endif %}
  <hr>
  <h3>All posts </h3>
  {% for post in all_posts %}
    <div class="product-container container-fluid card my-3 border border-info" style="width: 30rem;">
      <a class="text-decoration-none" href="{% url 'profile' post.username %}">
        <h4 class="fw-bold">{{ post.username }}</h4>
      </a>
      <h5 id="post-{{post.id}}">{{ post.post_content }}</h5>
      {% if post.username == user %}
        <button id="editpost-{{post.id}}" onclick="edit_post(id)">edit post</button>
      {% endif %}
      <h6 class="card-subtitle my-2 text-muted">{{ post.creation_time }}</h6>
      <p id="likecount-{{post.id}}">{{ post.likes }} likes</p>
      {% if user.is_authenticated %}
        <button id="like-{{post.id}}" onclick="like_post(id)">
          {% if user in post.liked_by.all %}
            remove like
          {% else %}
            like
          {% endif %}
        </button>
        <form id="postcomment-{{post.id}}" onsubmit="post_comment(event, id)">
          <input type="text" id="commentcontent-{{post.id}}" placeholder="comment.." required>
          <input type="submit" value="Submit">
        </form>
      {% endif %}
      <button id="loadcomment-{{post.id}}" onclick="load_comments(id)">show comments</button>
      <div id="comment-{{post.id}}" style="display: none;">
      </div>
    </div>
  {% endfor %}
  <ul class="pagination px-5" style="width: 100%;">
    {% if all_posts.has_previous %}
      <li class="page-item">
        <a href="?page=1" class="page-link">&laquo; first</a>
      </li>
      <li class="page-item">
        <a href="?page={{ all_posts.previous_page_number }}" class="page-link">previous</a>
      </li>
    {% endif %}
    <li class="page-item">
        <p class="page-link fw-bold">Page {{ all_posts.number }} of {{ all_posts.paginator.num_pages }}</p>
    </li>
    {% if all_posts.has_next %}
      <li class="page-item">
        <a href="?page={{ all_posts.next_page_number }}" class="page-link">next</a>
      </li>
      <li class="page-item">
        <a href="?page={{ all_posts.paginator.num_pages }}" class="page-link">last &raquo;</a>
      </li>
    {% endif %}
  </ul>
{% endblock %}

{% block script %}
  <script src="{% static 'network/index.js' %}"></script>
{% endblock %}
